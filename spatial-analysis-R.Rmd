--- 
title: "An Introduction to Spatial Data Analysis and Statistics: A Course in `R`"
author: "Antonio Paez"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
#output: 
#  bookdown::gitbook:
#      includes:
#            in_header: images\html_test\styles.css
documentclass: book
bibliography: [bibliography.bib, packages.bib]
biblio-style: apalike
link-citations: yes
github-repo: paezha/spatial-analysis-R
description: "This book was created as a resource for teaching applied spatial statistics at McMaster University by Antonio Paez, with support from Anastassios Dardas, Rajveer Ubhi, Megan Coad, and Alexis Polidoro. The book is published with support of an Open Educational Resources grant from MacPherson Institute, McMaster University."
graphics: yes
cover-image: "images/cover.jpg"
---

#  bookdown::gitbook:

Placeholder


## What is this book and who is it for? {-}
## Allied resources {-}
## Contributing {-}
### License
## How to support this project {-}

<!--chapter:end:index.Rmd-->


# Preface {-}

Placeholder


## Spatial Analysis and Spatial Statistics {-}
## Why this Text? {-}
## Plan {-}
## Audience {-}
## Requisites {-}
## Words of Appreciation {-}
## Versioning {-}

<!--chapter:end:00-Front-Matter.Rmd-->


# (PART) Part I: Getting to Know the Technology {-} 

Placeholder


## Introduction
## Learning Objectives
### What is `R`?
## Packages in R

<!--chapter:end:01-Installation.Rmd-->


# Basic Operations and Data Structures in `R` {#basic-operations}

Placeholder


## Learning Objectives
## RStudio IDE
## Some Basic Operations
## Data Classes in R
## Data Types in R
## Indexing and Data Transformations
## Visualization
## Creating a Simple Map
## References

<!--chapter:end:02-Basic-Operations-and-Data-Structures.Rmd-->


# (PART) Part II: Statistics and Maps {-}
# Introduction to Mapping in `R` {#introduction-to-maps}

Placeholder


## Learning Objectives
## Suggested Readings
## Preliminaries
## Packages
## Exploring Dataframes and a Simple Proportional Symbols Map
## Improving on the Proportional Symbols Map
## Some Simple Spatial Analysis
## Other Resources

<!--chapter:end:03-Introduction-to-Mapping.Rmd-->

# Activity: Statistical Maps I

*NOTE*: The source files for this book are available with companion package [{isdas}](https://paezha.github.io/isdas/). The source files are in Rmarkdown format and packed as templates. These files allow you execute code within the notebook, so that you can work interactively with the notes. 

## Housekeeping Questions

Answer the following questions:

1. What are the office hours of your instructor this term?

2. How are assignments graded?

3. What is the policy for late assignments in this course?

## Learning Objectives

In this activity you will:

1. Discuss statistical maps and what makes them interesting.

## Preliminaries

In the practice that preceded this activity, you used `ggmap` to create a proportional symbol map, a mapping technique used in spatial statistics for visualization of geocoded event information. As well, you implemented a simple technique called kernel analysis to the map to explore the distribution of events in the case of the cholera outbreak of Soho in London in 1854. Geocoded events are often called _point patterns_, so with the cholera data you were working with a point pattern.

In this activity, we will map another type of spatial data, called _areal data_. Areas are often administrative or political jurisdictions.

It is good practice to clear the working space to make sure that you do not have extraneous items there when you begin your work. The command in R to clear the workspace is `rm` (for "remove"), followed by a list of items to be removed. To clear the workspace from _all_ objects, do the following:
```{r ch05-}
rm(list = ls())
```

Note that `ls()` lists all objects currently on the workspace.

Load the libraries you will use in this activity:
```{r message=FALSE}
library(isdas)
library(sf)
library(tidyverse)
```

## Creating a simple thematic map

If you successfully loaded package `isdas` a dataset called `HamiltonDAs` should be available for analysis:
```{r}
data(HamiltonDAs)
```

Check the class of this object:
```{r}
class(HamiltonDAs)
```

As you can see, this is an object of class `sf`, which stands for _simple features_. Objects of this class are used in the R package `sf` (see [here](https://cran.r-project.org/web/packages/sf/vignettes/sf1.html)) to implement standards for [spatial objects](https://en.wikipedia.org/wiki/Simple_Features).

You can examine the contents of the dataset by means of `head` (which will show the top rows):
```{r}
head(HamiltonDAs)
```

Or obtain the summary statistics by means of `summary`:
```{r}
summary(HamiltonDAs)
```

The above will include a column for the geometry of the spatial features.

The dataframe includes all _Dissemination Areas_ (or DAs for short) for the Hamilton Census Metropolitan Area in Canada. DAs are a type of geography used by the Census of Canada, in fact the smallest geography that is publicly available.

To create a simple map we can use `ggplot2`, which previously we used to map points. Now, the geom for objects of class `sf` can be used to plot areas. To create such a map, we layer a geom object of type `sf` on a `ggplot2` object. For instance, to plot the DAs:
```{r}
#head(HamiltonDAs)
ggplot(HamiltonDAs) + 
  geom_sf(fill = "gray", color = "black", alpha = .3, size = .3)
```

We selected color "black" for the polygons, with a transparency alpha = 0.3 (alpha = 0 is completely transparent, alpha = 1 is completely opaque, try it!), and line size 0.3.

This map only shows the DAs, which is nice. However, as you saw in the summary of the dataframe above, in addition to the geometric information, a set of (generic) variables is also included, called VAR1, VAR2,..., VAR5.

Thematic maps can be created using these variables. The next chunk of code plots the DAs and adds info. The `fill` argument is used to select a variable to color the polygons. The function `cut_number` is used to classify the values of the variable in $k$ groups of equal size, in this case 5 (notice that the lines of the polygons are still black). The `scale_fill_brewer` function can be used to select different _palettes_ or coloring schemes):
```{r}
ggplot(HamiltonDAs) +
  geom_sf(aes(fill = cut_number(HamiltonDAs$VAR1, 5)), color = "black", alpha = 1, size = .3) +
  scale_fill_brewer(palette = "Reds") +
  coord_sf() +
  labs(fill = "Variable")
```

Now you have seen how to create a thematic map with polygons (areal data), you are ready for the following activity.

## Activity

**NOTE**: Activities include technical "how to" tasks/questions. Usually, these ask you to practice using the software to organize data, create plots, and so on in support of analysis and interpretation. The second type of questions ask you to activate your brainware and to think statistically.

<!-- Example of a textbox -->

::: {.infobox .software data-latex="{software}"}
**Activity Part I**
:::

<!--

Questions to practice using software to generate figures,
tables, summary statistics, maps!-->

1. Create thematic maps for variables VAR1 through VAR5 in the dataframe `HamiltonDAs`. Remember that you can introduce new chunks of code.

::: {.infobox .brainware data-latex="{brainware}"}
**Activity Part II**

Questions to practice using your brainware to interpret the
output of the software and to think statistically
:::


2. Imagine that the maps you produced in the first question were found, and for some reason the variables were not labeled. They may represent income, or population density, or something else. Which of the five maps you just created is more interesting? Rank the five maps from most to least interesting. Explain the reasons for your ranking.

<!--chapter:end:04-Activity-Statistical-Maps.Rmd-->


# Mapping in R: Continued {#mapping-continued}

Placeholder


## Learning Objectives
## Suggested Readings
## Preliminaries
## Summarizing a Dataframe
## Factors
## Subsetting Data
## Pipe Operator
## More on Visualization

<!--chapter:end:05-Mapping-in-R-Continued.Rmd-->


# Activity 2: Statistical Maps II

Placeholder


## Housekeeping Questions
## Learning objectives
## Suggested reading
## Preliminaries
## Activity

<!--chapter:end:06-Activity-Mapping-in-R-Continued.Rmd-->


# Maps as Processes: Null Landscapes, Spatial Processes, and Statistical Maps {#maps-as-processes}

Placeholder


## Learning Objectives
## Suggested Readings
## Preliminaries
## Random Numbers
## Null Landscapes
## Stochastic Processes
## Simulating Spatial Processes
## Processes and Patterns

<!--chapter:end:07-Maps-as-Processes.Rmd-->


# Activity 3: Maps as Processes

Placeholder


## Practice Questions
## Learning Objectives
## Suggested Reading
## Preliminaries
## Activity

<!--chapter:end:08-Activity-Maps-as-Processes.Rmd-->


# (PART) Part III: Analysis of Point Patterns {-}
# Point Pattern Analysis I {#point-pattern-analysis-i}

Placeholder


## Learning Objectives
## Suggested Readings
## Preliminaries
## Point Patterns
## Processes and Point Patterns
## Intensity and Density
## Quadrats and Density Maps
## Defining the Region for Analysis

<!--chapter:end:09-Point-Pattern-Analysis-I.Rmd-->


# Activity 4: Point Pattern Analysis I

Placeholder


## Practice questions
## Learning objectives
## Suggested reading
## Preliminaries
## Activity

<!--chapter:end:10-Activity-Point-Pattern-Analysis-I.Rmd-->


# Point Pattern Analysis II {#point-patern-analysis-ii}

Placeholder


## Learning Objectives
## Suggested Readings
## Preliminaries
## A Quadrat-based Test for Spatial Independence
## Limitations of Quadrat Analysis: Size and Number of Quadrats
## Limitations of Quadrat Analysis: Relative Position of Events
## Kernel Density

<!--chapter:end:11-Point-Pattern-Analysis-II.Rmd-->


# Activity 5: Point Pattern Analysis II

Placeholder


## Practice questions
## Learning objectives
## Suggested reading
## Preliminaries
## Activity

<!--chapter:end:12-Activity-Point-Pattern-Analysis-II.Rmd-->


# Point Pattern Analysis III

Placeholder


## Learning Objectives
## Suggested Readings
## Preliminaries
## Motivation
## Nearest Neighbors
## $G$-function

<!--chapter:end:13-Point-Pattern-Analysis-III.Rmd-->


# Activity 6: Point Pattern Analysis III

Placeholder


## Practice questions
## Learning objectives
## Suggested reading
## Preliminaries
## Activity

<!--chapter:end:14-Activity-Point-Pattern-Analysis-III.Rmd-->


# Point Pattern Analysis IV

Placeholder


## Learning Objectives
## Suggested Readings
## Preliminaries
## Motivation
## F-function
## $\hat{K}$-function

<!--chapter:end:15-Point-Pattern-Analysis-IV.Rmd-->


# Activity 7: Point Pattern Analysis IV

Placeholder


## Practice questions
## Learning objectives
## Suggested reading
## Preliminaries
## Activity

<!--chapter:end:16-Activity-Point-Pattern-Analysis-IV.Rmd-->


# Point Pattern Analysis V

Placeholder


## Learning Objectives
## Suggested Readings
## Preliminaries
## Motivation: Hypothesis Testing
## Null Landscapes Revisited
## Simulation Envelopes
## Things to Keep in Mind!
### Definition of a Region
### Edge Effects
### Sampled Point Patterns

<!--chapter:end:17-Point-Pattern-Analysis-V.Rmd-->


# Activity 8: Point Pattern Analysis V

Placeholder


## Practice questions
## Learning objectives
## Suggested reading
## Preliminaries
## Activity

<!--chapter:end:18-Activity-Point-Pattern-Analysis-V.Rmd-->


# (PART) Part IV: Data in Areal Units {-}
# Area Data I

Placeholder


## Learning Objectives
## Suggested Readings
## Preliminaries
## Area Data
## Processes and Area Data
## Visualizing Area Data: Choropleth Maps
## Visualizing Area Data: Cartograms

<!--chapter:end:19-Area-Data-I.Rmd-->


# Activity 9: Area Data I

Placeholder


## Practice questions
## Learning objectives
## Suggested reading
## Preliminaries
## Activity

<!--chapter:end:20-Activity-Area-Data-I.Rmd-->


# Area Data II

Placeholder


## Learning Objectives
## Suggested Readings
## Preliminaries
## Proximity in Area Data
## Spatial Weights Matrices
## Creating Spatial Weights Matrices in `R`
## Spatial Moving Averages
## Other Criteria for Coding Proximity

<!--chapter:end:21-Area-Data-II.Rmd-->


# Activity 10: Area Data II

Placeholder


## Practice questions
## Learning objectives
## Suggested reading
## Preliminaries
## Activity

<!--chapter:end:22-Activity-Area-Data-II.Rmd-->


# Area Data III

Placeholder


## Learning Objectives
## Suggested Readings
## Preliminaries
## Spatial Moving Averages and Simulation
## The Spatial Moving Average as a Smoother
## Spatial Moving Average Scatterplots
## Spatial Autocorrelation and Moran's $I$ coefficient
## Moran's $I$ and Moran's Scatterplot
## Hypothesis Testing for Spatial Autocorrelation

<!--chapter:end:23-Area-Data-III.Rmd-->


# Activity 11: Area Data III

Placeholder


## Practice questions
## Learning objectives
## Suggested reading
## Preliminaries
## Activity

<!--chapter:end:24-Activity-Area-Data-III.Rmd-->


# Area Data IV

Placeholder


## Learning objectives
## Suggested readings
## Preliminaries
## Decomposing Moran's $I$
## Local Moran's $I$ and Mapping
## A Quick Note on Functions
## A Concentration approach for Local Analysis of Spatial Association
## A Short Note on Hypothesis Testing
## Detection of Hot and Cold Spots
## Other Resources

<!--chapter:end:25-Area-Data-IV.Rmd-->


# Activity 12: Area Data IV

Placeholder


## Practice questions
## Learning objectives
## Suggested reading
## Preliminaries
## Activity

<!--chapter:end:26-Activity-Area-Data-IV.Rmd-->


# Area Data V

Placeholder


## Learning Objectives
## Suggested Readings
## Preliminaries
## Regression Analysis in `R`
## Autocorrelation as a Model Diagnostic
## Variable Transformations
## A Note about Spatial Autocorrelation in Regression Analysis

<!--chapter:end:27-Area-Data-V.Rmd-->


# Activity 13: Area Data V

Placeholder


## Practice questions
## Learning objectives
## Suggested reading
## Preliminaries
## Activity

<!--chapter:end:28-Activity-Area-Data-V.Rmd-->


# Area Data VI

Placeholder


## Learning Objectives
## Suggested Readings
## Preliminaries
## Residual spatial autocorrelation revisited
### Incorrect Functional Form
### Omitted Variables
## Remedial Action
## Flexible Functional Forms and Models with Spatially-varying Coefficients
### Trend Surface Analysis
### Models with Spatially-varying Coefficients
#### Expansion Method
#### Geographically Weighted Regression (GWR)
## Spatial Error Model (SEM)

<!--chapter:end:29-Area-Data-VI.Rmd-->


# Activity 14: Area Data VI

Placeholder


## Practice questions
## Learning objectives
## Suggested reading
## Preliminaries
### New York leukemia data
### Pennsylvania lung cancer
## Activity

<!--chapter:end:30-Activity-Area-Data-VI.Rmd-->


# (PART) Part V: Analysis and Prediction of Fields {-}
# Spatially Continuous Data I {#spatially-continuous-data-i}

Placeholder


## Learning objectives
## Suggested readings
## Preliminaries
## Spatially continuous (field) data
## Exploratory visualization
## Tile-based methods
## Inverse distance weighting (IDW)
## $k$-point means

<!--chapter:end:31-Spatially-Continuous-Data-I.Rmd-->


# Activity 15: Spatially Continuous Data I

Placeholder


## Practice questions
## Learning objectives
## Suggested reading
## Preliminaries
## Activity

<!--chapter:end:32-Activity-Spatially-Continuous-Data-I.Rmd-->


# Spatially Continuous Data II

Placeholder


## Learning objectives
## Suggested readings
## Preliminaries
## Uncertainty in the predictions
## Trend surface analysis
## Accuracy and precision

<!--chapter:end:33-Spatially-Continuous-Data-II.Rmd-->


# Activity 16: Spatially Continuous Data II

Placeholder


## Practice questions
## Learning objectives
## Suggested reading
## Preliminaries
## Activity

<!--chapter:end:34-Activity-Spatially-Continuous-Data-II.Rmd-->


# Spatially Continuous Data III {#spatially-continuous-data-iii}

Placeholder


## Learning objectives
## Suggested reading
## Preliminaries
## Residual spatial pattern
## Measuring spatial dependence in spatially continuous data
## Variographic analyisis

<!--chapter:end:35-Spatially-Continuous-Data-III.Rmd-->


# Activity 17: Spatially Continuous Data III

Placeholder


## Practice questions
## Learning objectives
## Suggested reading
## Preliminaries
## Activity

<!--chapter:end:36-Activity-Spatially-Continuous-Data-III.Rmd-->


# Spatially Continuous Data IV

Placeholder


## Learning objectives
## Suggested reading
## Preliminaries
## Using residual spatial pattern to estimate prediction errors
## Kriging: a method for optimal prediction.

<!--chapter:end:37-Spatially-Continuous-Data-IV.Rmd-->


# Activity 18: Spatially Continuous Data IV

Placeholder


## Practice questions
## Learning objectives
## Suggested reading
## Preliminaries
## Activity

<!--chapter:end:38-Activity-Spatially-Continuous-Data-IV.Rmd-->

